<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SAGE MARK 85 - SMIT'S AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #ffcc00; --red: #ff0000; --dark: #0a0000; }
        body { background: var(--dark); color: var(--gold); font-family: 'Orbitron', sans-serif; height: 100vh; margin: 0; display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; }
        
        /* THE CORE & VISION HUD */
        #core-container { position: relative; width: 280px; height: 280px; border-radius: 50%; overflow: hidden; border: 4px solid var(--red); box-shadow: 0 0 40px var(--red); background: #000; }
        video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0; transition: 1s; filter: sepia(1) hue-rotate(320deg) saturate(4) contrast(1.2); }
        svg { position: absolute; z-index: 10; width: 100%; height: 100%; pointer-events: none; }
        .ring { fill: none; stroke: var(--gold); stroke-width: 2; transform-origin: center; }
        #outer { stroke-dasharray: 40, 20; animation: spin 10s linear infinite; stroke: var(--red); }
        #glow { fill: var(--gold); opacity: 0.1; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* HUD TEXT ELEMENTS */
        #hud { position: absolute; bottom: 8%; text-align: center; width: 100%; }
        #status { font-size: 10px; letter-spacing: 5px; color: var(--red); margin-bottom: 5px; font-weight: bold; }
        #transcript { color: #fff; font-size: 14px; margin-bottom: 15px; min-height: 20px; text-transform: uppercase; text-shadow: 0 0 5px var(--red); }
        
        /* COMMAND BOX */
        input { background: rgba(255, 0, 0, 0.1); border: 2px solid var(--red); color: var(--gold); padding: 15px; width: 400px; font-family: 'Orbitron'; outline: none; text-align: center; box-shadow: 0 0 15px rgba(255,0,0,0.2); transition: 0.3s; }
        input:focus { border-color: var(--gold); box-shadow: 0 0 25px var(--red); }

        /* BOOT BUTTON */
        #boot { position: fixed; inset: 0; background: #000; z-index: 1000; display: flex; align-items: center; justify-content: center; }
        #boot button { background: var(--red); color: white; border: none; padding: 25px 60px; font-family: 'Orbitron'; cursor: pointer; font-size: 20px; box-shadow: 0 0 30px var(--red); letter-spacing: 5px; }
    </style>
</head>
<body>

    <div id="boot"><button onclick="bootSystem()">ENGAGE NEURAL LINK</button></div>

    <div id="core-container">
        <video id="webcam" autoplay playsinline></video>
        <svg viewBox="0 0 200 200">
            <circle id="outer" class="ring" cx="100" cy="100" r="90" />
            <circle class="ring" cx="100" cy="100" r="75" stroke-opacity="0.2" />
            <circle id="glow" cx="100" cy="100" r="45" />
            <circle cx="100" cy="100" r="8" fill="#fff" />
        </svg>
    </div>

    <div id="hud">
        <div id="status">MARK 85 SYSTEM: STANDBY</div>
        <div id="transcript">AWAITING INPUT...</div>
        <input type="text" id="cmdInput" placeholder="ENTER COMMAND OR SPEAK...">
    </div>

    <script>
        // REPLACE THIS KEY IF IT EXPIRES
        const API_KEY = "AIzaSyDXmKaJNhJaQNSDtpCtNcnGFzRC-WHsGP0"; 
        const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        const synth = window.speechSynthesis;

        function bootSystem() {
            document.getElementById('boot').style.display = 'none';
            document.getElementById('status').innerText = "SYSTEMS LIVE - UPLINK ACTIVE";
            speak("Welcome back, Smit. SAGE Protocol is active in the Mark 85 armor. All systems are at your command.");
            startVoice();
        }

        // --- THE BRAIN: HANDLES COMMANDS ---
        async function processCommand(cmd) {
            cmd = cmd.toLowerCase();
            document.getElementById('transcript').innerText = `"${cmd.toUpperCase()}"`;

            // 1. YouTube (Instant System Command)
            if (cmd.includes("youtube")) {
                speak("Accessing YouTube database, Sir.");
                window.open("https://www.youtube.com", "_blank");
                return;
            }

            // 2. Camera/Scan (Instant System Command)
            if (cmd.includes("camera") || cmd.includes("scan") || cmd.includes("vision")) {
                speak("Engaging vision HUD. Scanning environment.");
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
                    const video = document.getElementById('webcam');
                    video.srcObject = stream;
                    video.style.opacity = "1";
                } catch (e) { speak("Sir, camera sensors are blocked by the OS."); }
                return;
            }

            // 3. Search (Instant System Command)
            if (cmd.includes("search") || cmd.includes("google")) {
                let query = cmd.replace("search", "").replace("google", "");
                speak(`Searching the archives for ${query}.`);
                window.open(`https://www.google.com/search?q=${query}`, "_blank");
                return;
            }

            // 4. General Questions (AI Brain Uplink)
            document.getElementById('status').innerText = "QUERYING CLOUD...";
            const response = await askGemini(cmd);
            speak(response);
            document.getElementById('status').innerText = "SYSTEMS LIVE - UPLINK ACTIVE";
        }

        async function askGemini(query) {
            const endpoint = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
            try {
                const res = await fetch(endpoint, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ contents: [{ parts: [{ text: `You are SAGE, the AI assistant for Smit. You live in his Iron Man Mark 85 armor. Be witty, sophisticated, and call him Sir. Answer briefly. Query: ${query}` }] }] })
                });
                
                const data = await res.json();
                if (data.error) throw new Error(data.error.message);
                return data.candidates[0].content.parts[0].text;
            } catch (err) {
                console.error(err);
                return "Sir, the network bridge is failing. Please run me through a server like GitHub Pages to enable my brain.";
            }
        }

        // --- INPUT CONTROLS ---
        document.getElementById('cmdInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                processCommand(e.target.value);
                e.target.value = "";
            }
        });

        function startVoice() {
            try { recognition.start(); } catch(e) {}
        }

        recognition.onresult = (e) => processCommand(e.results[0][0].transcript);
        recognition.onend = () => { if(!synth.speaking) startVoice(); };

        function speak(text) {
            synth.cancel(); 
            const utter = new SpeechSynthesisUtterance(text);
            const voices = synth.getVoices();
            // Try to find a cool British male voice
            utter.voice = voices.find(v => v.lang.includes('en-GB') && v.name.includes('Male')) || voices[0];
            utter.pitch = 0.85;
            utter.onend = () => startVoice();
            synth.speak(utter);
        }

        window.speechSynthesis.onvoiceschanged = () => synth.getVoices();
    </script>
</body>
</html>